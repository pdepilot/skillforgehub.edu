<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkillForge Â· intelligent dashboard</title>
  <!-- Bootstrap icons & grid -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ---------- GLOBAL (calm, premium) ---------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Outfit', sans-serif;
      background: #f4fafd;
      color: #1c2e3f;
      line-height: 1.5;
      min-height: 100vh;
      padding: 2rem 1.5rem;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: radial-gradient(rgba(127,195,176,0.06) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: -1;
    }
    :root {
      --fog-deep: #0f2b3c;
      --fog-mid: #2b5f6b;
      --mist-green: #7fc3b0;
      --accent-glow: #ffb347;
      --soft-white: rgba(255,255,255,0.85);
      --border-radius-card: 32px;
      --border-radius-element: 24px;
    }

    /* ---------- DASHBOARD LAYOUT (preserved) ---------- */
    .dashboard-container {
      max-width: 1440px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 1.8rem;
    }

    .sidebar {
      flex: 0 0 280px;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 50px;
      padding: 2rem 1.2rem;
      box-shadow: 0 30px 50px -30px #1a4b5a, 0 0 0 1px rgba(127,195,176,0.2) inset;
      border: 1px solid rgba(255,255,255,0.7);
      height: fit-content;
      transition: all 0.3s;
    }
    .sidebar .brand {
      font-size: 1.6rem;
      font-weight: 700;
      color: #0f2f3f;
      padding-left: 0.5rem;
      margin-bottom: 2.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .brand i { color: #7fc3b0; font-size: 2rem; }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      margin: 0.4rem 0;
      border-radius: 50px;
      color: #1a4b5a;
      font-weight: 500;
      transition: 0.2s;
      cursor: pointer;
    }
    .nav-item i { font-size: 1.4rem; width: 28px; color: #2b5f6b; }
    .nav-item.active {
      background: #7fc3b0;
      color: #0f2f3f;
      box-shadow: 0 10px 20px -12px #1a4b5a;
    }
    .nav-item.active i { color: #0f2f3f; }
    .nav-item:hover:not(.active) {
      background: rgba(127,195,176,0.2);
    }

    .main-content {
      flex: 1;
      min-width: 300px;
    }

    /* profile header (preserved) */
    .profile-header {
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(16px);
      border-radius: 60px;
      padding: 2rem 2.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 20px 30px -20px #1a4b5a, 0 0 0 1px rgba(127,195,176,0.15) inset;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 2rem;
      border: 1px solid rgba(255,255,255,0.7);
    }
    .avatar-large {
      width: 110px;
      height: 110px;
      background: linear-gradient(145deg, #7fc3b0, #b3dfd2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.2rem;
      color: #0f2f3f;
      border: 4px solid white;
      box-shadow: 0 15px 25px -15px #1a4b5a;
    }
    .profile-info h2 { font-size: 2.2rem; font-weight: 700; margin-bottom: 0.2rem; }
    .role-badge {
      background: #7fc3b0;
      border-radius: 40px;
      padding: 0.3rem 1.2rem;
      font-weight: 600;
      display: inline-block;
      margin: 0.4rem 0;
    }
    .edit-profile-btn {
      background: white;
      border: 2px solid #7fc3b0;
      border-radius: 50px;
      padding: 0.8rem 2rem;
      font-weight: 600;
      transition: 0.2s;
      margin-left: auto;
    }
    .edit-profile-btn:hover {
      background: #7fc3b0;
      color: white;
    }

    /* section titles */
    .section-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin: 2rem 0 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.5rem;
    }
    .premium-card {
      background: white;
      border-radius: 40px;
      padding: 1.5rem;
      box-shadow: 0 15px 30px -20px #1f4b5a;
      border: 1px solid rgba(127,195,176,0.2);
      transition: transform 0.2s, box-shadow 0.3s;
    }
    .premium-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 25px 35px -22px #0f2f3f, 0 0 0 2px #7fc3b0 inset;
    }
    .progress { height: 10px; border-radius: 20px; background: #e3f0ec; margin: 1rem 0; }
    .progress-bar { background: #7fc3b0; border-radius: 20px; }

    .notif-badge {
      background: #ffb347;
      color: #0f2f3f;
      border-radius: 40px;
      padding: 0.2rem 0.8rem;
      font-weight: 600;
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }

    /* edit modal */
    .edit-modal {
      background: white;
      border-radius: 60px;
      padding: 2rem;
      box-shadow: 0 40px 60px -25px #0f2b3c;
      border: 1px solid #7fc3b0;
      max-width: 500px;
      margin: 2rem auto;
      position: fixed;
      top: 50%; left: 50%; transform: translate(-50%,-50%);
      z-index: 2000;
      width: 90%;
    }

    .message-item {
      display: flex;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(127,195,176,0.2);
    }

    /* new enhanced components */
    .insight-card {
      background: linear-gradient(135deg, rgba(127,195,176,0.1), rgba(255,255,255,0.5));
      border-radius: 50px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      border: 1px solid #7fc3b0;
      box-shadow: 0 10px 20px -15px #1a4b5a;
      animation: softGlow 3s infinite alternate;
    }
    @keyframes softGlow {
      0% { box-shadow: 0 0 0 0 rgba(127,195,176,0.3); }
      100% { box-shadow: 0 0 15px 5px rgba(127,195,176,0.2); }
    }
    .insight-text { font-size: 1.3rem; font-weight: 500; }

    .badge-icon {
      width: 50px; height: 50px; border-radius: 50%;
      background: #f0f9f5; display: flex; align-items: center; justify-content: center;
      font-size: 1.8rem; color: #7fc3b0; border: 2px solid #7fc3b0;
      transition: 0.2s;
    }
    .badge-item:hover .badge-icon { transform: scale(1.1); background: #7fc3b0; color: white; }

    .completion-ring { width: 70px; height: 70px; border-radius: 50%; background: conic-gradient(#7fc3b0 0deg 288deg, #e3f0ec 288deg 360deg); display: flex; align-items: center; justify-content: center; background-color: #e3f0ec; }
    .ring-inner { width: 55px; height: 55px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-weight: 700; }

    .hidden { display: none !important; }
    .text-accent { color: #7fc3b0; }

    @media (max-width: 992px) {
      .dashboard-container { flex-direction: column; }
      .sidebar { flex: auto; width: 100%; }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- SIDEBAR (preserved) -->
    <aside class="sidebar">
      <div class="brand"><i class="bi bi-shield-fill"></i> SkillForge</div>
      <nav>
        <div class="nav-item active" data-section="overview"><i class="bi bi-house-door"></i> Overview</div>
        <div class="nav-item" data-section="courses"><i class="bi bi-book"></i> My Courses</div>
        <div class="nav-item" data-section="messages"><i class="bi bi-chat-dots"></i> Messages <span class="notif-badge" id="messageBadge">3</span></div>
        <div class="nav-item" data-section="certificates"><i class="bi bi-patch-check"></i> Certificates</div>
        <div class="nav-item" data-section="payments"><i class="bi bi-credit-card"></i> Billing</div>
        <div class="nav-item" data-section="settings"><i class="bi bi-gear"></i> Settings</div>
        <div class="nav-item" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Log out</div>
      </nav>
    </aside>

    <main class="main-content" id="mainContent">
      <!-- profile header -->
      <div class="profile-header" id="profileHeader">
        <div class="avatar-large" id="avatar">ðŸ‘¤</div>
        <div class="profile-info">
          <h2 id="displayName">Alex Morgan</h2>
          <div><span class="role-badge" id="roleBadge">Student</span></div>
          <div id="displayEmail">alex@example.com</div>
        </div>
        <button class="edit-profile-btn" id="openEditProfileBtn"><i class="bi bi-pencil-square"></i> Edit profile</button>
      </div>

      <!-- AI INSIGHTS PANEL (new) -->
      <div class="insight-card" id="insightCard">
        <i class="bi bi-stars fs-1" style="color:#7fc3b0;"></i>
        <span class="insight-text" id="insightMessage">Analyzing your progress...</span>
      </div>

      <!-- sections (preserved structure, extended) -->
      <div id="overviewSection" class="section-panel">
        <div class="section-title"><i class="bi bi-graph-up"></i> Overview</div>
        <div id="overviewContent"></div>

        <!-- new widgets inside overview -->
        <div class="section-title mt-5"><i class="bi bi-trophy"></i> Achievements & Badges</div>
        <div id="achievementsGrid" class="card-grid"></div>

        <div class="section-title mt-5"><i class="bi bi-clock-history"></i> Productivity Analytics</div>
        <div id="analyticsContent" class="premium-card"></div>

        <div class="section-title mt-5"><i class="bi bi-calendar-check"></i> Smart Reminders</div>
        <div id="remindersContent" class="premium-card"></div>

        <div class="section-title mt-5"><i class="bi bi-people"></i> Mentor Suggestions</div>
        <div id="mentorGrid" class="card-grid"></div>

        <div class="section-title mt-5"><i class="bi bi-lightbulb"></i> Recommended for you</div>
        <div id="recommendationsGrid" class="card-grid"></div>
      </div>

      <!-- other panels (hidden by default) -->
      <div id="coursesSection" class="section-panel hidden"><div class="section-title"><i class="bi bi-book"></i> My Courses</div><div id="coursesContent" class="card-grid"></div></div>
      <div id="messagesSection" class="section-panel hidden"><div class="section-title"><i class="bi bi-chat-dots"></i> Messages</div><div id="messagesContent" class="premium-card"></div></div>
      <div id="certificatesSection" class="section-panel hidden"><div class="section-title"><i class="bi bi-patch-check"></i> Certificates</div><div id="certificatesContent" class="card-grid"></div></div>
      <div id="paymentsSection" class="section-panel hidden"><div class="section-title"><i class="bi bi-credit-card"></i> Billing & payments</div><div id="paymentsContent"></div></div>
      <div id="settingsSection" class="section-panel hidden"><div class="section-title"><i class="bi bi-gear"></i> Account Settings</div><div class="premium-card" id="settingsCard"></div></div>
    </main>
  </div>

  <!-- edit modal (preserved) -->
  <div id="editProfileModal" class="edit-modal hidden">
    <h3 class="mb-4">Edit profile</h3>
    <form id="editProfileForm">
      <div class="mb-3"><label>Full name</label><input type="text" class="form-control rounded-pill" id="editName"></div>
      <div class="mb-3"><label>Email</label><input type="email" class="form-control rounded-pill" id="editEmail"></div>
      <div class="mb-3" id="studentGoalField"><label>Learning goals</label><textarea class="form-control rounded-4" id="editGoals" rows="2"></textarea></div>
      <div class="mb-3" id="instructorBioField"><label>Bio / expertise</label><textarea class="form-control rounded-4" id="editBio" rows="2"></textarea></div>
      <div class="mb-3"><label>New password (optional)</label><input type="password" class="form-control rounded-pill" id="editPassword" placeholder="Leave blank"></div>
      <div class="d-flex gap-3"><button type="submit" class="btn btn-premium flex-grow-1" style="background:#7fc3b0; border-radius:60px; padding:0.8rem;">Save changes</button><button type="button" class="btn btn-outline-secondary rounded-pill px-4" id="cancelEdit">Cancel</button></div>
    </form>
  </div>
  <div id="modalBackdrop" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.2); backdrop-filter:blur(4px); z-index:1999;"></div>

  <script>
    (function() {
      // ---------- STORAGE KEYS (must match enroll page) ----------
      const STORAGE_KEYS = {
        student: 'skillforge_student',
        instructor: 'skillforge_instructor',
        auth: 'skillforge_logged_in_user'
      };
      
      let currentUser = null;
      let userRole = 'student';

      // Load user data from localStorage
      function loadUser() {
        // First try to get from auth storage
        const auth = localStorage.getItem(STORAGE_KEYS.auth);
        if (auth) {
          try { 
            currentUser = JSON.parse(auth); 
            userRole = currentUser.role || 'student'; 
            return;
          } catch (e) {
            console.error('Error parsing auth data', e);
          }
        }
        
        // If no auth, try student storage
        const studentData = localStorage.getItem(STORAGE_KEYS.student);
        if (studentData) {
          try {
            currentUser = JSON.parse(studentData);
            userRole = 'student';
            // Sync to auth
            localStorage.setItem(STORAGE_KEYS.auth, JSON.stringify(currentUser));
            return;
          } catch (e) {
            console.error('Error parsing student data', e);
          }
        }
        
        // If no student, try instructor storage
        const instructorData = localStorage.getItem(STORAGE_KEYS.instructor);
        if (instructorData) {
          try {
            currentUser = JSON.parse(instructorData);
            userRole = 'instructor';
            // Sync to auth
            localStorage.setItem(STORAGE_KEYS.auth, JSON.stringify(currentUser));
            return;
          } catch (e) {
            console.error('Error parsing instructor data', e);
          }
        }
        
        // If no data at all, use fallback
        fallback();
      }
      
      function fallback() {
        currentUser = { 
          firstName: 'Alex', 
          lastName: 'Morgan', 
          email: 'alex.m@example.com', 
          role: 'student', 
          goals: 'Master frontend development', 
          bio: '', 
          stats: { streak: 12, completed: 4 },
          experience: 'intermediate',
          interests: ['web', 'design']
        };
        userRole = 'student';
        // Save fallback to storage
        localStorage.setItem(STORAGE_KEYS.auth, JSON.stringify(currentUser));
        localStorage.setItem(STORAGE_KEYS.student, JSON.stringify(currentUser));
      }
      
      // Load user data
      loadUser();

      // DOM elements
      const navItems = document.querySelectorAll('.nav-item[data-section]');
      const sections = {
        overview: document.getElementById('overviewSection'),
        courses: document.getElementById('coursesSection'),
        messages: document.getElementById('messagesSection'),
        certificates: document.getElementById('certificatesSection'),
        payments: document.getElementById('paymentsSection'),
        settings: document.getElementById('settingsSection')
      };
      
      const displayName = document.getElementById('displayName');
      const roleBadge = document.getElementById('roleBadge');
      const displayEmail = document.getElementById('displayEmail');
      const avatar = document.getElementById('avatar');
      
      const overviewContent = document.getElementById('overviewContent');
      const coursesContent = document.getElementById('coursesContent');
      const messagesContent = document.getElementById('messagesContent');
      const certificatesContent = document.getElementById('certificatesContent');
      const paymentsContent = document.getElementById('paymentsContent');
      const settingsCard = document.getElementById('settingsCard');
      
      const achievementsGrid = document.getElementById('achievementsGrid');
      const analyticsContent = document.getElementById('analyticsContent');
      const remindersContent = document.getElementById('remindersContent');
      const mentorGrid = document.getElementById('mentorGrid');
      const recommendationsGrid = document.getElementById('recommendationsGrid');
      const insightMessage = document.getElementById('insightMessage');

      // Update header with real user data
      function updateHeader() {
        const fullName = `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim() || 'User';
        displayName.innerText = fullName;
        roleBadge.innerText = userRole === 'student' ? 'Student' : 'Instructor';
        displayEmail.innerText = currentUser.email || 'user@example.com';
        
        // Set avatar based on role
        if (userRole === 'instructor') {
          avatar.innerHTML = `<i class="bi bi-easel"></i>`;
        } else {
          avatar.innerHTML = `<i class="bi bi-person-circle"></i>`;
        }
      }

      // AI insights based on user data
      const insights = [
        `âœ¨ Welcome back, ${currentUser.firstName || 'User'}! You're making great progress.`,
        `ðŸ† You're ${currentUser.stats?.completed || 0} courses closer to your goals!`,
        `ðŸ“ˆ Keep up the momentum! Your streak is ${currentUser.stats?.streak || 0} days.`,
        `ðŸ’¡ Based on your interests, try our advanced courses.`,
        `ðŸŽ¯ You've completed 75% of your current learning goal.`
      ];
      
      let insightIndex = 0;
      setInterval(() => { 
        insightIndex = (insightIndex + 1) % insights.length; 
        insightMessage.innerText = insights[insightIndex]; 
      }, 6000);

      // Render overview with real user data
      function renderOverview() {
        // Overview stats
        if (userRole === 'student') {
          overviewContent.innerHTML = `
            <div class="card-grid">
              <div class="premium-card">
                <i class="bi bi-lightning-charge fs-1 text-accent"></i>
                <h4>Learning streak</h4>
                <p class="fw-bold fs-3">${currentUser.stats?.streak || 0} days</p>
              </div>
              <div class="premium-card">
                <i class="bi bi-trophy fs-1 text-accent"></i>
                <h4>Courses completed</h4>
                <p class="fw-bold fs-3">${currentUser.stats?.completed || 0}</p>
              </div>
              <div class="premium-card">
                <i class="bi bi-clock-history fs-1 text-accent"></i>
                <h4>Experience level</h4>
                <p class="fw-bold fs-5">${currentUser.experience || 'Beginner'}</p>
              </div>
            </div>
          `;
        } else {
          overviewContent.innerHTML = `
            <div class="card-grid">
              <div class="premium-card">
                <i class="bi bi-people fs-1 text-accent"></i>
                <h4>Students</h4>
                <p class="fw-bold fs-3">${currentUser.stats?.students || 0}</p>
              </div>
              <div class="premium-card">
                <i class="bi bi-star fs-1 text-accent"></i>
                <h4>Rating</h4>
                <p class="fw-bold fs-3">${currentUser.stats?.rating || '4.8'}</p>
              </div>
              <div class="premium-card">
                <i class="bi bi-play-circle fs-1 text-accent"></i>
                <h4>Courses</h4>
                <p class="fw-bold fs-3">${currentUser.coursesCreated?.length || 0}</p>
              </div>
            </div>
          `;
        }

        // Achievements based on user data
        let badges = '';
        if (userRole === 'student') {
          const interests = currentUser.interests || [];
          badges = `
            <div class="premium-card badge-item">
              <div class="badge-icon"><i class="bi bi-award"></i></div>
              <h6>Getting Started</h6>
              <small>Joined SkillForge</small>
            </div>
            ${interests.includes('web') ? `
            <div class="premium-card badge-item">
              <div class="badge-icon"><i class="bi bi-code-slash"></i></div>
              <h6>Web Developer</h6>
              <small>Interested in web dev</small>
            </div>` : ''}
            ${currentUser.stats?.streak > 5 ? `
            <div class="premium-card badge-item">
              <div class="badge-icon"><i class="bi bi-fire"></i></div>
              <h6>On Fire!</h6>
              <small>${currentUser.stats?.streak} day streak</small>
              <div class="progress mt-2"><div class="progress-bar" style="width:${Math.min(100, (currentUser.stats?.streak/30)*100)}%"></div></div>
            </div>` : ''}
          `;
        } else {
          badges = `
            <div class="premium-card badge-item">
              <div class="badge-icon"><i class="bi bi-mic"></i></div>
              <h6>Rising instructor</h6>
              <small>Expert in ${currentUser.expertise || 'your field'}</small>
            </div>
            <div class="premium-card badge-item">
              <div class="badge-icon"><i class="bi bi-star"></i></div>
              <h6>Premium Educator</h6>
              <small>Sharing knowledge</small>
            </div>
          `;
        }
        achievementsGrid.innerHTML = badges;

        // Productivity analytics
        analyticsContent.innerHTML = `
          <div style="display:flex; gap:2rem; flex-wrap:wrap;">
            <div><i class="bi bi-clock"></i> Goal: ${currentUser.goals || 'Complete courses'} <span class="text-accent">in progress</span></div>
            <div><i class="bi bi-bar-chart"></i> Level: ${currentUser.experience || 'beginner'}</div>
            <div><i class="bi bi-graph-up"></i> Status: <span class="text-accent">active learner</span></div>
          </div>
          <div class="progress mt-3"><div class="progress-bar" style="width:${Math.min(100, (currentUser.stats?.completed || 0) * 25)}%"></div></div>
          <p class="mt-2">${(currentUser.stats?.completed || 0) * 25}% toward next milestone</p>
        `;

        // Smart reminders based on user data
        remindersContent.innerHTML = `
          <div><i class="bi bi-exclamation-circle"></i> ${userRole === 'student' ? 
            `Continue your ${currentUser.interests?.length ? currentUser.interests[0] : 'learning'} journey` : 
            'Create your next course'}</div>
          <div class="mt-2"><i class="bi bi-chat"></i> Connect with the community</div>
          <div class="mt-2"><i class="bi bi-calendar"></i> Study session scheduled tomorrow</div>
          <button class="btn btn-sm btn-outline-success rounded-pill mt-3" id="dismissReminder">Dismiss</button>
        `;
        
        document.getElementById('dismissReminder')?.addEventListener('click', (e) => {
          e.target.parentElement.style.opacity = '0.5';
        });

        // Mentor suggestions based on user interests
        if (userRole === 'student') {
          mentorGrid.innerHTML = `
            <div class="premium-card">
              <i class="bi bi-person-circle fs-1"></i>
              <h5>Sarah Chen</h5>
              <p>${currentUser.interests?.includes('web') ? 'Web expert' : 'Learning advisor'} Â· 98% match</p>
              <button class="btn btn-sm btn-outline-primary rounded-pill">Connect</button>
            </div>
            <div class="premium-card">
              <i class="bi bi-person-circle fs-1"></i>
              <h5>Marcus Lee</h5>
              <p>${currentUser.interests?.includes('design') ? 'UI/UX designer' : 'Career coach'} Â· 85% match</p>
              <button class="btn btn-sm btn-outline-primary rounded-pill">Connect</button>
            </div>
          `;
        }

        // Recommendations based on interests
        recommendationsGrid.innerHTML = `
          <div class="premium-card">
            <h5>${currentUser.interests?.includes('web') ? 'TypeScript Deep Dive' : 'Getting Started Guide'}</h5>
            <p class="text-muted">Recommended for you</p>
            <div class="progress"><div class="progress-bar" style="width:0%"></div></div>
          </div>
          <div class="premium-card">
            <h5>${currentUser.interests?.includes('data') ? 'Data Science Fundamentals' : 'Next Steps in Learning'}</h5>
            <p class="text-muted">Based on your profile</p>
          </div>
        `;
      }

      // Render courses with real data
      function renderCourses() {
        if (userRole === 'student') {
          const enrolledCourses = currentUser.enrolledCourses || [];
          if (enrolledCourses.length > 0) {
            coursesContent.innerHTML = enrolledCourses.map(course => `
              <div class="premium-card">
                <h5>${course.name}</h5>
                <p>${course.progress}%</p>
                <div class="progress"><div class="progress-bar" style="width:${course.progress}%"></div></div>
                <button class="btn btn-sm btn-outline-success rounded-pill mt-3">Continue</button>
              </div>
            `).join('');
          } else {
            coursesContent.innerHTML = `
              <div class="premium-card">
                <h5>Start your first course</h5>
                <p>Based on your interests: ${currentUser.interests?.join(', ') || 'various topics'}</p>
                <button class="btn btn-sm btn-success rounded-pill">Browse courses</button>
              </div>
            `;
          }
        } else {
          const createdCourses = currentUser.coursesCreated || [];
          if (createdCourses.length > 0) {
            coursesContent.innerHTML = createdCourses.map(course => `
              <div class="premium-card">
                <h5>${course.name}</h5>
                <p>Students: ${course.students || 0} Â· Rating ${course.rating || '4.5'}</p>
                <span class="badge bg-success">Published</span>
              </div>
            `).join('');
          } else {
            coursesContent.innerHTML = `
              <div class="premium-card">
                <h5>Create your first course</h5>
                <p>Share your expertise in ${currentUser.expertise || 'your field'}</p>
                <button class="btn btn-sm btn-success rounded-pill">Start creating</button>
              </div>
            `;
          }
        }
      }

      function renderMessages() {
        messagesContent.innerHTML = userRole === 'student' 
          ? `<div class="message-item"><i class="bi bi-person-circle"></i><div><b>Welcome!</b><p>Start your learning journey today</p></div></div>`
          : `<div class="message-item"><i class="bi bi-person-circle"></i><div><b>Getting started</b><p>Create your first course</p></div></div>`;
      }

      function renderCertificates() {
        certificatesContent.innerHTML = userRole === 'student' 
          ? `<div class="premium-card"><i class="bi bi-award fs-1"></i><h5>Keep learning</h5><p>Complete courses to earn certificates</p></div>`
          : `<p>Certificates you award appear here.</p>`;
      }

      function renderPayments() {
        paymentsContent.innerHTML = `
          <div class="premium-card">
            <h5>Membership</h5>
            <p class="fs-2">Free tier</p>
            <p>Upgrade for premium features</p>
          </div>
        `;
      }

      function renderSettings() {
        settingsCard.innerHTML = `
          <h5>Profile Information</h5>
          <p><strong>Name:</strong> ${currentUser.firstName} ${currentUser.lastName}</p>
          <p><strong>Email:</strong> ${currentUser.email}</p>
          <p><strong>Role:</strong> ${userRole}</p>
          ${userRole === 'student' ? `
            <p><strong>Goals:</strong> ${currentUser.goals || 'Not set'}</p>
            <p><strong>Experience:</strong> ${currentUser.experience || 'Beginner'}</p>
            <p><strong>Interests:</strong> ${currentUser.interests?.join(', ') || 'None selected'}</p>
          ` : `
            <p><strong>Expertise:</strong> ${currentUser.expertise || 'Not set'}</p>
            <p><strong>Bio:</strong> ${currentUser.bio || 'No bio yet'}</p>
            ${currentUser.linkedin ? `<p><strong>LinkedIn:</strong> ${currentUser.linkedin}</p>` : ''}
          `}
          <button class="btn btn-premium rounded-pill mt-3" id="inlineEditBtn">Edit profile</button>
          <hr>
          <h6>Account Security</h6>
          <p>Last login: today Â· <i class="bi bi-shield"></i> active</p>
        `;
        
        document.getElementById('inlineEditBtn')?.addEventListener('click', openEditModal);
      }

      function showSection(section) {
        Object.values(sections).forEach(s => {
          if (s) s.classList.add('hidden');
        });
        
        if (sections[section]) {
          sections[section].classList.remove('hidden');
        }
        
        navItems.forEach(n => n.classList.remove('active'));
        const activeNav = document.querySelector(`.nav-item[data-section="${section}"]`);
        if (activeNav) activeNav.classList.add('active');
        
        // Render section content
        if (section === 'overview') renderOverview();
        if (section === 'courses') renderCourses();
        if (section === 'messages') renderMessages();
        if (section === 'certificates') renderCertificates();
        if (section === 'payments') renderPayments();
        if (section === 'settings') renderSettings();
      }

      // Navigation
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          const section = item.getAttribute('data-section');
          if (section) showSection(section);
        });
      });

      // Edit modal functionality
      const editModal = document.getElementById('editProfileModal');
      const backdrop = document.getElementById('modalBackdrop');
      const openEditBtn = document.getElementById('openEditProfileBtn');
      const cancelEdit = document.getElementById('cancelEdit');
      const editForm = document.getElementById('editProfileForm');
      const editName = document.getElementById('editName');
      const editEmail = document.getElementById('editEmail');
      const editGoals = document.getElementById('editGoals');
      const editBio = document.getElementById('editBio');

      function openEditModal() {
        if (!editModal || !backdrop) return;
        
        editName.value = `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim();
        editEmail.value = currentUser.email || '';
        
        if (userRole === 'student') {
          const studentGoalField = document.getElementById('studentGoalField');
          const instructorBioField = document.getElementById('instructorBioField');
          if (studentGoalField) studentGoalField.classList.remove('hidden');
          if (instructorBioField) instructorBioField.classList.add('hidden');
          editGoals.value = currentUser.goals || '';
        } else {
          const studentGoalField = document.getElementById('studentGoalField');
          const instructorBioField = document.getElementById('instructorBioField');
          if (studentGoalField) studentGoalField.classList.add('hidden');
          if (instructorBioField) instructorBioField.classList.remove('hidden');
          editBio.value = currentUser.bio || '';
        }
        
        editModal.classList.remove('hidden');
        backdrop.classList.remove('hidden');
      }

      if (openEditBtn) {
        openEditBtn.addEventListener('click', openEditModal);
      }
      
      if (cancelEdit) {
        cancelEdit.addEventListener('click', () => {
          editModal.classList.add('hidden');
          backdrop.classList.add('hidden');
        });
      }
      
      if (backdrop) {
        backdrop.addEventListener('click', () => {
          editModal.classList.add('hidden');
          backdrop.classList.add('hidden');
        });
      }

      if (editForm) {
        editForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          const nameParts = editName.value.trim().split(' ');
          currentUser.firstName = nameParts[0] || '';
          currentUser.lastName = nameParts.slice(1).join(' ') || '';
          currentUser.email = editEmail.value;
          
          if (userRole === 'student') {
            currentUser.goals = editGoals.value;
          } else {
            currentUser.bio = editBio.value;
          }
          
          // Save updated user data to all storage locations
          localStorage.setItem(STORAGE_KEYS.auth, JSON.stringify(currentUser));
          
          if (userRole === 'student') {
            localStorage.setItem(STORAGE_KEYS.student, JSON.stringify(currentUser));
          } else {
            localStorage.setItem(STORAGE_KEYS.instructor, JSON.stringify(currentUser));
          }
          
          // Update UI
          updateHeader();
          renderOverview();
          renderSettings();
          
          editModal.classList.add('hidden');
          backdrop.classList.add('hidden');
          
          showGlobalMessage('Profile updated successfully!', 'success');
        });
      }

      // Logout
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
          // Clear auth but keep user data for next login
          localStorage.removeItem(STORAGE_KEYS.auth);
          window.location.href = 'sign-in.html';
        });
      }

      // Global message helper
      function showGlobalMessage(text, type = 'success') {
        const msgDiv = document.createElement('div');
        msgDiv.className = `global-message ${type}`;
        msgDiv.style.position = 'fixed';
        msgDiv.style.top = '1rem';
        msgDiv.style.left = '50%';
        msgDiv.style.transform = 'translateX(-50%)';
        msgDiv.style.zIndex = '3000';
        msgDiv.style.minWidth = '300px';
        msgDiv.style.textAlign = 'center';
        msgDiv.innerHTML = (type === 'success' ? '<i class="bi bi-check-circle-fill"></i> ' : '<i class="bi bi-shield-exclamation"></i> ') + text;
        document.body.appendChild(msgDiv);
        
        setTimeout(() => {
          msgDiv.remove();
        }, 3000);
      }

      // Initial render
      updateHeader();
      renderOverview();
      showSection('overview');
      if (insightMessage) {
        insightMessage.innerText = insights[0];
      }

      // Check if user just signed up (redirect from enroll page)
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('new') === 'true') {
        showGlobalMessage('Welcome to SkillForge! Your profile is ready.', 'success');
      }
    })();
  </script>
</body>
</html>