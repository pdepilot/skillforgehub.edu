<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkillForge ¬∑ welcome back</title>
  <!-- Bootstrap icons (lightweight, only icons used) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ---------- RESET & GLOBAL ---------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: linear-gradient(145deg, #f0f7fa 0%, #e5f0f5 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      color: #1a3b4f;
      line-height: 1.5;
      position: relative;
      transition: padding-right 0.3s ease;
    }

    body.assistant-open {
      padding-right: 380px; /* space for assistant panel */
    }

    /* subtle background pattern (safe, premium) */
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(rgba(127,195,176,0.08) 1px, transparent 1px);
      background-size: 30px 30px;
      pointer-events: none;
    }

    /* ---------- MAIN CARD (GLASS) ---------- */
    .signin-card {
      max-width: 480px;
      width: 100%;
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border-radius: 60px;
      padding: 3rem 2.5rem;
      box-shadow: 
        0 40px 60px -30px rgba(15, 60, 70, 0.35),
        0 0 0 1px rgba(127, 195, 176, 0.25) inset,
        0 20px 40px -20px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.5);
      transition: transform 0.3s ease, box-shadow 0.4s ease;
      animation: cardFloat 0.6s ease-out;
      position: relative;
      z-index: 2;
    }

    @keyframes cardFloat {
      0% { opacity: 0; transform: translateY(12px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .signin-card:hover {
      box-shadow: 0 50px 70px -30px #1a4b5a, 0 0 0 1px #7fc3b0 inset;
    }

    /* header */
    .brand-header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .brand-icon {
      font-size: 3.2rem;
      color: #7fc3b0;
      background: rgba(127,195,176,0.12);
      width: 90px;
      height: 90px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.2rem;
      border: 2px solid rgba(127,195,176,0.3);
      transition: 0.3s;
    }

    .brand-icon i {
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05));
    }

    h1 {
      font-size: 2.3rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      color: #0f2f3f;
      margin-bottom: 0.25rem;
    }

    .welcome-tag {
      color: #2f5f6b;
      font-size: 1.1rem;
      font-weight: 400;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .welcome-tag i {
      color: #7fc3b0;
    }

    /* ---------- FORM ---------- */
    .input-group {
      margin-bottom: 2rem;
      position: relative;
    }

    .field-container {
      position: relative;
      margin-top: 0.5rem;
    }

    .field-container input {
      width: 100%;
      padding: 1.2rem 1.8rem;
      border: 2px solid rgba(127,195,176,0.25);
      border-radius: 50px;
      font-size: 1.1rem;
      background: rgba(255,255,255,0.7);
      transition: all 0.2s ease;
      font-family: 'Outfit', sans-serif;
      color: #0f2f3f;
    }

    .field-container input:focus {
      outline: none;
      border-color: #7fc3b0;
      box-shadow: 0 0 0 5px rgba(127,195,176,0.2);
      background: white;
    }

    .field-container label {
      position: absolute;
      left: 1.8rem;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      padding: 0 0.2rem;
      color: #5f7e8b;
      font-weight: 500;
      pointer-events: none;
      transition: 0.2s ease;
      font-size: 1rem;
      letter-spacing: 0.01em;
    }

    .field-container.float label {
      top: 0;
      transform: translateY(-50%) scale(0.9);
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(4px);
      color: #2b5f6b;
      font-weight: 600;
      padding: 0 0.6rem;
      left: 1.2rem;
    }

    .password-toggle {
      position: absolute;
      right: 1.8rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #5f7e8b;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0.2rem;
      z-index: 5;
      transition: color 0.2s;
    }

    .password-toggle:hover {
      color: #7fc3b0;
    }

    .validation-feedback {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      margin-left: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      color: #e67e4a;
      min-height: 1.8rem;
    }

    .validation-feedback.valid {
      color: #3c9b7a;
    }

    .validation-feedback i {
      font-size: 1rem;
    }

    .row-flex {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 1.8rem 0 2.2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      cursor: pointer;
      font-weight: 500;
      color: #1e4b5a;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: 1.3rem;
      height: 1.3rem;
      accent-color: #7fc3b0;
      border-radius: 6px;
      cursor: pointer;
    }

    .forgot-link {
      color: #2b5f6b;
      text-decoration: none;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: 0.2s;
    }

    .forgot-link:hover {
      border-bottom-color: #7fc3b0;
      color: #0f2f3f;
    }

    .signin-btn {
      width: 100%;
      background: #7fc3b0;
      border: none;
      border-radius: 60px;
      padding: 1.2rem;
      font-size: 1.4rem;
      font-weight: 700;
      color: #0f2f3f;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      box-shadow: 0 15px 25px -12px #7fc3b0;
      transition: all 0.2s cubic-bezier(0.2,0.9,0.4,1);
      cursor: pointer;
      margin-bottom: 2rem;
    }

    .signin-btn:hover {
      background: #ffb347;
      transform: scale(1.02);
      box-shadow: 0 20px 30px -12px #b38b4a;
    }

    .signin-btn:active {
      transform: scale(0.98);
    }

    .signin-btn i {
      font-size: 1.5rem;
    }

    .spinner {
      width: 1.5rem;
      height: 1.5rem;
      border: 3px solid rgba(15,47,63,0.2);
      border-top-color: #0f2f3f;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .trust-badge {
      background: rgba(127,195,176,0.1);
      border-radius: 60px;
      padding: 0.9rem 1.2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.95rem;
      color: #1a4b5a;
      margin-bottom: 2rem;
      border: 1px solid rgba(127,195,176,0.3);
    }

    .trust-badge i {
      font-size: 1.8rem;
      color: #7fc3b0;
    }

    .signup-redirect {
      text-align: center;
      font-size: 1.1rem;
    }

    .signup-redirect a {
      color: #7fc3b0;
      font-weight: 700;
      text-decoration: none;
      border-bottom: 2px solid transparent;
      transition: 0.2s;
    }

    .signup-redirect a:hover {
      border-bottom-color: #7fc3b0;
      color: #0f2f3f;
    }

    .global-message {
      background: #fdede5;
      border-radius: 60px;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: #b84a2c;
      border-left: 8px solid #e67e4a;
      animation: shake 0.4s ease;
    }

    .global-message.success {
      background: #e0f2e9;
      color: #1f6e4f;
      border-left-color: #3c9b7a;
    }

    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-3px); }
      80% { transform: translateX(3px); }
    }

    .strength-meter {
      height: 4px;
      background: rgba(0,0,0,0.05);
      border-radius: 4px;
      margin: 0.5rem 1rem 0;
      overflow: hidden;
      width: calc(100% - 2rem);
    }

    .strength-fill {
      height: 100%;
      width: 0%;
      background: #ffb347;
      transition: width 0.3s;
    }

    .returning-greeting {
      background: #eef7f2;
      border-radius: 40px;
      padding: 0.8rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 0.7rem;
      font-weight: 500;
    }

    /* ---------- SECURITY ASSISTANT PANEL (glass, premium) ---------- */
    .assistant-toggle {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: #7fc3b0;
      border: 3px solid white;
      box-shadow: 0 10px 25px rgba(15,43,60,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: #0f2b3c;
      cursor: pointer;
      transition: all 0.2s ease;
      z-index: 1001;
      animation: softPulse 2s infinite;
    }

    .assistant-toggle:hover {
      transform: scale(1.1);
      background: #ffb347;
    }

    @keyframes softPulse {
      0% { box-shadow: 0 0 0 0 rgba(127,195,176,0.5); }
      70% { box-shadow: 0 0 0 15px rgba(127,195,176,0); }
      100% { box-shadow: 0 0 0 0 rgba(127,195,176,0); }
    }

    .assistant-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 360px;
      height: 100vh;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: -10px 0 40px -20px #0f2b3c;
      border-left: 2px solid rgba(127,195,176,0.3);
      padding: 2rem 1.5rem;
      transition: right 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
      z-index: 1002;
      display: flex;
      flex-direction: column;
      border-radius: 40px 0 0 40px;
    }

    .assistant-panel.open {
      right: 0;
    }

    .assistant-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.8rem;
    }

    .assistant-header h3 {
      font-weight: 700;
      color: #0f2b3c;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 1.5rem;
    }

    .assistant-header i {
      color: #7fc3b0;
      font-size: 2rem;
    }

    .close-assistant {
      background: none;
      border: none;
      font-size: 2rem;
      color: #2b5f6b;
      cursor: pointer;
      padding: 0 0.5rem;
    }

    .assistant-chat {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
      scroll-behavior: smooth;
    }

    .message {
      max-width: 90%;
      padding: 0.9rem 1.4rem;
      border-radius: 30px;
      font-size: 0.95rem;
      animation: messageAppear 0.3s ease;
      line-height: 1.4;
    }

    @keyframes messageAppear {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .assistant-message {
      align-self: flex-start;
      background: #eaf3f0;
      border-bottom-left-radius: 10px;
      color: #0f2b3c;
    }

    .user-message {
      align-self: flex-end;
      background: #7fc3b0;
      color: white;
      border-bottom-right-radius: 10px;
    }

    .typing-indicator {
      display: flex;
      gap: 0.4rem;
      padding: 0.8rem 1.2rem;
      background: #eaf3f0;
      border-radius: 30px;
      width: fit-content;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: #2b5f6b;
      border-radius: 50%;
      animation: typingBounce 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
      0%,60%,100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }

    .assistant-suggestions {
      background: rgba(127,195,176,0.08);
      border-radius: 30px;
      padding: 1.2rem;
      margin: 1rem 0;
    }

    .suggestion-title {
      font-weight: 600;
      margin-bottom: 0.8rem;
      color: #0f2b3c;
    }

    .suggestion-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
    }

    .chip {
      background: white;
      border: 1.5px solid #7fc3b0;
      border-radius: 40px;
      padding: 0.5rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 500;
      color: #0f2b3c;
      cursor: pointer;
      transition: 0.2s;
    }

    .chip:hover {
      background: #7fc3b0;
      color: white;
    }

    .assistant-input-area {
      display: flex;
      gap: 0.6rem;
      margin-top: 0.5rem;
    }

    .assistant-input-area input {
      flex: 1;
      border: 2px solid rgba(127,195,176,0.4);
      border-radius: 50px;
      padding: 0.8rem 1.2rem;
      font-family: 'Outfit', sans-serif;
      background: white;
    }

    .assistant-input-area button {
      background: #7fc3b0;
      border: none;
      border-radius: 50px;
      width: 50px;
      height: 50px;
      font-size: 1.3rem;
      color: #0f2b3c;
      transition: 0.2s;
    }

    .assistant-input-area button:hover {
      background: #ffb347;
    }

    /* device recognition badge */
    .device-badge {
      background: rgba(127,195,176,0.15);
      border-radius: 40px;
      padding: 0.6rem 1.2rem;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(127,195,176,0.4);
    }

    .hidden {
      display: none;
    }

    /* focus highlight for assistant tips */
    .field-highlight {
      outline: 4px solid rgba(127,195,176,0.4);
      transition: outline 0.2s;
    }

    /* responsive */
    @media (max-width: 768px) {
      body.assistant-open { padding-right: 0; }
      .assistant-panel { width: 300px; right: -320px; }
      .assistant-toggle { bottom: 1rem; right: 1rem; }
    }
  </style>
</head>
<body>
  <div class="signin-card" id="signinCard">
    <div class="brand-header">
      <div class="brand-icon">
        <i class="bi bi-shield-lock-fill"></i>
      </div>
      <h1>welcome back</h1>
      <div class="welcome-tag" id="welcomeTag">
        <i class="bi bi-star-fill"></i>
        <span id="greetingText">sign in to continue</span>
      </div>
    </div>

    <!-- device recognition banner (dynamic) -->
    <div id="deviceBadge" class="device-badge hidden"></div>

    <!-- returning user banner (hidden initially) -->
    <div id="returningBanner" class="returning-greeting hidden">
      <i class="bi bi-person-check-fill" style="color:#7fc3b0;"></i>
      <span id="returningMessage"></span>
    </div>

    <!-- global message (error / success) -->
    <div id="globalMessage" class="global-message hidden"></div>

    <!-- sign in form (no backend) -->
    <form id="signinForm" novalidate>
      <!-- email field -->
      <div class="input-group">
        <div class="field-container" id="emailContainer">
          <input type="email" id="email" value="" autocomplete="email" spellcheck="false">
          <label for="email">Email address</label>
          <div class="validation-feedback" id="emailFeedback"></div>
        </div>
      </div>

      <!-- password field with show/hide -->
      <div class="input-group">
        <div class="field-container" id="passwordContainer">
          <input type="password" id="password" autocomplete="current-password">
          <label for="password">Password</label>
          <button type="button" class="password-toggle" id="togglePassword" tabindex="-1" aria-label="Show password">
            <i class="bi bi-eye" id="toggleIcon"></i>
          </button>
          <div class="validation-feedback" id="passwordFeedback"></div>
        </div>
        <!-- optional strength meter (soft hint) -->
        <div class="strength-meter"><div class="strength-fill" id="strengthFill"></div></div>
      </div>

      <!-- remember me & forgot -->
      <div class="row-flex">
        <label class="checkbox-wrapper">
          <input type="checkbox" id="rememberMe" checked>
          <span>Remember me</span>
        </label>
        <a href="#" class="forgot-link" id="forgotLink">forgot password?</a>
      </div>

      <!-- sign in button with loading simulation -->
      <button type="submit" class="signin-btn" id="signinBtn">
        <span>Sign in</span>
        <i class="bi bi-arrow-right-short"></i>
      </button>

      <!-- trust badge -->
      <div class="trust-badge">
        <i class="bi bi-incognito"></i>
        <span>Your data is encrypted ¬∑ 256-bit SSL ¬∑ calm & secure</span>
      </div>

      <div class="signup-redirect">
        New to SkillForge? <a href="#" id="signupLink">Create an account</a>
      </div>
    </form>
  </div>

  <!-- Security Assistant Toggle & Panel -->
  <div class="assistant-toggle" id="assistantToggle" role="button" tabindex="0" aria-label="Security assistant">
    <i class="bi bi-shield-shaded"></i>
  </div>

  <div class="assistant-panel" id="assistantPanel">
    <div class="assistant-header">
      <h3><i class="bi bi-robot"></i> Security assistant</h3>
      <button class="close-assistant" id="closeAssistant" aria-label="Close assistant"><i class="bi bi-x-lg"></i></button>
    </div>

    <div class="assistant-chat" id="assistantChat">
      <div class="message assistant-message">üîê I'm your security guide. Ask me anything about signing in securely.</div>
    </div>

    <div class="assistant-suggestions">
      <div class="suggestion-title">Common questions</div>
      <div class="suggestion-chips" id="suggestionChips">
        <span class="chip" data-question="Why can't I sign in?">Can't sign in?</span>
        <span class="chip" data-question="Is my account secure?">Account security</span>
        <span class="chip" data-question="Forgot my password">Forgot password</span>
        <span class="chip" data-question="Caps lock detected?">Caps lock?</span>
      </div>
    </div>

    <div class="assistant-input-area">
      <input type="text" id="assistantInput" placeholder="Ask a question...">
      <button id="sendAssistantMsg"><i class="bi bi-send"></i></button>
    </div>
  </div>

  <script>
    (function() {
      // DOM elements
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const emailContainer = document.getElementById('emailContainer');
      const passwordContainer = document.getElementById('passwordContainer');
      const emailFeedback = document.getElementById('emailFeedback');
      const passwordFeedback = document.getElementById('passwordFeedback');
      const toggleBtn = document.getElementById('togglePassword');
      const toggleIcon = document.getElementById('toggleIcon');
      const signinBtn = document.getElementById('signinBtn');
      const signinForm = document.getElementById('signinForm');
      const globalMsg = document.getElementById('globalMessage');
      const returningBanner = document.getElementById('returningBanner');
      const returningMessage = document.getElementById('returningMessage');
      const greetingText = document.getElementById('greetingText');
      const rememberMe = document.getElementById('rememberMe');
      const forgotLink = document.getElementById('forgotLink');
      const strengthFill = document.getElementById('strengthFill');
      const deviceBadge = document.getElementById('deviceBadge');

      // Assistant elements
      const assistantToggle = document.getElementById('assistantToggle');
      const assistantPanel = document.getElementById('assistantPanel');
      const closeAssistant = document.getElementById('closeAssistant');
      const assistantChat = document.getElementById('assistantChat');
      const assistantInput = document.getElementById('assistantInput');
      const sendBtn = document.getElementById('sendAssistantMsg');
      const suggestionChips = document.querySelectorAll('.chip');
      const body = document.body;

      // ---------- LocalStorage keys ----------
      const STORAGE_KEY = 'skillforge_remembered_user';
      const DEVICE_KEY = 'skillforge_device_known';
      const FAIL_ATTEMPTS_KEY = 'skillforge_fail_attempts';

      let rememberedEmail = localStorage.getItem(STORAGE_KEY) || '';
      let deviceKnown = localStorage.getItem(DEVICE_KEY) === 'true';
      let failAttempts = parseInt(localStorage.getItem(FAIL_ATTEMPTS_KEY) || '0');

      // floating labels
      function handleFloat(container, input) {
        if (input.value.trim() !== '') {
          container.classList.add('float');
        } else {
          container.classList.remove('float');
        }
      }

      [emailInput, passwordInput].forEach(input => {
        const container = input.id === 'email' ? emailContainer : passwordContainer;
        input.addEventListener('input', () => handleFloat(container, input));
        input.addEventListener('blur', () => handleFloat(container, input));
        handleFloat(container, input);
      });

      toggleBtn.addEventListener('click', () => {
        const type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordInput.type = type;
        toggleIcon.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
      });

      // real-time validation
      emailInput.addEventListener('input', validateEmail);
      passwordInput.addEventListener('input', validatePassword);
      passwordInput.addEventListener('input', updateStrength);

      function validateEmail() {
        const email = emailInput.value.trim();
        const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        if (email === '') {
          emailFeedback.innerHTML = '';
          return false;
        } else if (!isValid) {
          emailFeedback.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i> Valid email needed';
          return false;
        } else {
          emailFeedback.innerHTML = '<i class="bi bi-check-circle-fill" style="color:#3c9b7a;"></i> Looks good';
          return true;
        }
      }

      function validatePassword() {
        const pwd = passwordInput.value;
        if (pwd === '') {
          passwordFeedback.innerHTML = '';
          return false;
        } else if (pwd.length < 6) {
          passwordFeedback.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i> At least 6 characters';
          return false;
        } else {
          passwordFeedback.innerHTML = '<i class="bi bi-check-circle-fill" style="color:#3c9b7a;"></i> Strong enough';
          return true;
        }
      }

      function updateStrength() {
        const pwd = passwordInput.value;
        let strength = 0;
        if (pwd.length >= 4) strength = 25;
        if (pwd.length >= 6) strength = 50;
        if (pwd.length >= 8 && /[^a-zA-Z0-9]/.test(pwd)) strength = 75;
        if (pwd.length >= 10 && /[A-Z]/.test(pwd) && /[0-9]/.test(pwd) && /[^a-zA-Z0-9]/.test(pwd)) strength = 100;
        strengthFill.style.width = strength + '%';
      }

      // device recognition & returning user
      if (!deviceKnown) {
        deviceBadge.classList.remove('hidden');
        deviceBadge.innerHTML = '<i class="bi bi-laptop"></i> New device detected ¬∑ security checks active';
        localStorage.setItem(DEVICE_KEY, 'true');
      } else {
        deviceBadge.classList.remove('hidden');
        deviceBadge.innerHTML = '<i class="bi bi-shield-check"></i> Trusted device ¬∑ connection secure';
      }

      if (rememberedEmail) {
        emailInput.value = rememberedEmail;
        handleFloat(emailContainer, emailInput);
        returningBanner.classList.remove('hidden');
        returningMessage.innerText = `Welcome back, ${rememberedEmail.split('@')[0]}!`;
        greetingText.innerText = 'good to see you again';
      }

      // caps lock detection
      passwordInput.addEventListener('keydown', (e) => {
        if (e.getModifierState && e.getModifierState('CapsLock')) {
          addAssistantMessage('‚ö†Ô∏è Caps lock is on ‚Äî this may affect your password', 'assistant');
        }
      });

      // forgot link
      forgotLink.addEventListener('click', (e) => {
        e.preventDefault();
        showGlobalMessage('Password reset link sent (demo)', 'success');
        addAssistantMessage('I‚Äôve simulated a reset email. Check your inbox (demo).', 'assistant');
      });

      document.getElementById('signupLink').addEventListener('click', (e) => {
        e.preventDefault();
        showGlobalMessage('Redirect to signup (demo)', 'success');
      });

      function showGlobalMessage(text, type = 'error') {
        globalMsg.textContent = text;
        globalMsg.classList.remove('hidden', 'success');
        if (type === 'success') globalMsg.classList.add('success');
        globalMsg.innerHTML = (type === 'success' ? '<i class="bi bi-check-circle-fill"></i> ' : '<i class="bi bi-shield-exclamation"></i> ') + text;
        globalMsg.classList.remove('hidden');
        setTimeout(() => globalMsg.classList.add('hidden'), 4000);
      }

      // ---------- ASSISTANT FUNCTIONS ----------
      function addAssistantMessage(text, sender = 'assistant') {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message', sender === 'assistant' ? 'assistant-message' : 'user-message');
        msgDiv.textContent = text;
        assistantChat.appendChild(msgDiv);
        assistantChat.scrollTop = assistantChat.scrollHeight;
      }

      function showTypingThenResponse(response) {
        const typingDiv = document.createElement('div');
        typingDiv.classList.add('typing-indicator');
        typingDiv.innerHTML = '<span></span><span></span><span></span>';
        assistantChat.appendChild(typingDiv);
        assistantChat.scrollTop = assistantChat.scrollHeight;

        setTimeout(() => {
          assistantChat.removeChild(typingDiv);
          addAssistantMessage(response, 'assistant');
        }, 1200);
      }

      function handleAssistantQuestion(question) {
        addAssistantMessage(question, 'user');
        const q = question.toLowerCase();
        if (q.includes('sign in') || q.includes('can\'t')) {
          showTypingThenResponse('Double-check your email and password. If you‚Äôve tried multiple times, you can reset your password ‚Äî I can help with that.');
        } else if (q.includes('secure') || q.includes('safe')) {
          showTypingThenResponse('Your connection is encrypted. We use modern safeguards and never share your data. You‚Äôre in a safe environment.');
        } else if (q.includes('forgot') || q.includes('reset')) {
          showTypingThenResponse('Click "forgot password?" below ‚Äî we‚Äôll send a reset link instantly. (simulated)');
        } else if (q.includes('caps')) {
          showTypingThenResponse('I can detect caps lock. Make sure it‚Äôs off before typing your password.');
        } else {
          showTypingThenResponse('I‚Äôm here to help with sign-in issues, security, or account access. What would you like to know?');
        }
      }

      // assistant open/close
      assistantToggle.addEventListener('click', () => {
        assistantPanel.classList.add('open');
        body.classList.add('assistant-open');
      });
      closeAssistant.addEventListener('click', () => {
        assistantPanel.classList.remove('open');
        body.classList.remove('assistant-open');
      });

      sendBtn.addEventListener('click', () => {
        const text = assistantInput.value.trim();
        if (!text) return;
        handleAssistantQuestion(text);
        assistantInput.value = '';
      });

      assistantInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendBtn.click();
      });

      suggestionChips.forEach(chip => {
        chip.addEventListener('click', () => {
          handleAssistantQuestion(chip.getAttribute('data-question'));
        });
      });

      // context-aware assistant: password focus
      passwordInput.addEventListener('focus', () => {
        if (assistantPanel.classList.contains('open')) {
          addAssistantMessage('‚ú® Tip: use a unique password with letters, numbers, and symbols.', 'assistant');
        }
      });

      // login attempt simulation with risk awareness
      signinForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const isEmailValid = validateEmail();
        const isPasswordValid = validatePassword();
        const email = emailInput.value.trim();
        const pwd = passwordInput.value;

        if (!isEmailValid || !isPasswordValid) {
          failAttempts++;
          localStorage.setItem(FAIL_ATTEMPTS_KEY, failAttempts);
          if (failAttempts >= 2) {
            addAssistantMessage('Having trouble? You can reset your password or ask me for help.', 'assistant');
          }
          showGlobalMessage('Invalid credentials ‚Äî please try again', 'error');
          return;
        }

        if (pwd === 'password' || pwd === '123456') {
          failAttempts++;
          localStorage.setItem(FAIL_ATTEMPTS_KEY, failAttempts);
          showGlobalMessage('That password is too common ‚Äî try another', 'error');
          addAssistantMessage('Weak password detected. Choose something harder to guess.', 'assistant');
          return;
        }

        // success
        signinBtn.innerHTML = '<span></span><div class="spinner"></div><span> signing in</span>';
        signinBtn.disabled = true;

        if (rememberMe.checked) {
          localStorage.setItem(STORAGE_KEY, email);
        } else {
          localStorage.removeItem(STORAGE_KEY);
        }
        localStorage.setItem(DEVICE_KEY, 'true');
        localStorage.removeItem(FAIL_ATTEMPTS_KEY); // reset attempts

        setTimeout(() => {
          signinBtn.innerHTML = '<i class="bi bi-check-lg"></i> Welcome back!';
          signinBtn.style.background = '#ffb347';
          showGlobalMessage('Login successful ‚Äî redirecting (demo)', 'success');
          addAssistantMessage('‚úÖ You‚Äôre signed in! (simulated redirect)', 'assistant');
          setTimeout(() => {
            signinBtn.innerHTML = '<span>Sign in</span><i class="bi bi-arrow-right-short"></i>';
            signinBtn.disabled = false;
            signinBtn.style.background = '#7fc3b0';
          }, 2000);
        }, 1500);
      });

      // initial assistant welcome
      setTimeout(() => {
        if (!localStorage.getItem(DEVICE_KEY)) {
          addAssistantMessage('üëã I see this might be your first time on this device. I‚Äôm here to help!', 'assistant');
        }
      }, 1000);
    })();
  </script>
</body>
</html>